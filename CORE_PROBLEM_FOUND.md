# 核心问题分析：游戏实现严重偏离设计

## 设计文档中的游戏（应该是什么）

### 核心循环（来自 WastelandCastle.txt）
```
安全屋（整备）→ 旅途（战斗）→ 结算 → 下一个安全屋
    ↓              ↓              ↓
  拼装载具      采集/杀怪      获得奖励
  购买组件      清理障碍
  修复车体      锁定布局
```

### 玩家核心交互
1. **光标（无人机）** - 玩家的主要操作对象：
   - ✅ 悬停采集资源点（BlueRes建材）
   - ⚠️ 悬停挖掘障碍物（树、石头）- 已实现但可能有问题
   - ❌ **悬停攻击敌人**（光标本身有攻击能力！"英雄的攻击必须是自动瞄准/吸附"）
   - ⚠️ 引导"CURSOR"类型武器的瞄准 - 代码支持但测试组件都是NEAREST

2. **拼装系统** - 策略核心：
   - ❌ 安全屋中拖拽组件到网格
   - ❌ 多种形状组件（1x1, 1x2, L型等）
   - ❌ 商店系统（刷新、购买、锁定）
   - ❌ 修复系统（消耗BlueRes修复组件）
   - ✅ 邻接加成（已实现）

3. **旅途玩法** - 横版卷轴：
   - ✅ 载具固定屏幕左1/3，背景向左卷动
   - ❌ 敌人从右侧生成，向左攻击载具
   - ✅ 障碍物阻挡载具（ObstacleSystem已实现）
   - ⚠️ 资源节点随地图生成

## 当前实际实现（错误的）

### 核心循环
```
波次准备（8秒）→ 波次战斗 → 波次完成（2秒）→ 下一波
    ↓              ↓              ↓
  无交互         纯自动战斗      无奖励
```

### 致命问题

#### 1. **游戏类型错误**
- **设计**：横版卷轴 + Roguelike拼装 + 类吸血鬼幸存者
- **实现**：固定塔防 + 波次系统
- **结果**：玩家完全没有策略决策空间

#### 2. **安全屋系统缺失**
- `SafeHouseSystem` 存在但只是空壳
- 没有拖拽系统（DragSystem不存在）
- 没有商店系统
- 没有修复系统
- **玩家无法拼装载具，无法做任何准备**

#### 3. **敌人生成逻辑完全错误**
```javascript
// 当前：从屏幕四边随机生成（塔防逻辑）
getRandomSpawnPosition() {
  const side = Math.floor(Math.random() * 4); // 0:上, 1:右, 2:下, 3:左
  // ...
}

// 应该：从右侧生成，向左移动（卷轴逻辑）
// 敌人应该用世界坐标，跟随scrollSystem
```

#### 4. **光标交互严重不足**
- ❌ 光标本应有**攻击敌人**的能力（设计核心！）
- ❌ 光标本应能引导某些武器瞄准
- ✅ 只实现了采集资源点（功能不完整）

#### 5. **玩家无事可做**
当前玩家能做的：
1. 移动鼠标 - 但光标不能攻击，武器都是NEAREST自动瞄准
2. 采集资源 - 但采集后的BlueRes没有消费途径（没有修复系统）
3. 观看 - 武器自动射击

**结果：玩家只能看着自动战斗，1分钟都无法玩下去！**

## 核心流程应该是什么

### 完整游戏循环（设计意图）
```
1. 【安全屋】玩家准备（无时间限制）：
   - 拖拽组件拼装载具（空间策略）
   - 消费BlueRes修复受损组件
   - 消费Gold购买新组件
   - 选择下一站路线

2. 【旅途】玩家战斗（有时间/距离限制）：
   - 光标悬停攻击敌人（主要输出！）
   - 光标采集资源点（获取BlueRes）
   - 光标挖掘障碍物（恢复移动）
   - 载具武器自动辅助射击（次要输出）
   - 敌人从右侧来袭，向左攻击网格组件

3. 【结算】：
   - 统计击杀、采集、存活组件
   - 获得Gold奖励
   - 进入下一个安全屋

4. 循环往复，难度递增
```

## 需要做什么

### Phase 1: 修复敌人生成逻辑（让旅途变成卷轴）
- [ ] 敌人改为从右侧生成
- [ ] 敌人使用世界坐标
- [ ] 敌人向左移动攻击载具

### Phase 2: 实现光标攻击能力（让玩家有事可做）
- [ ] 光标悬停敌人自动攻击
- [ ] 光标攻击动画
- [ ] 光标攻击力可升级

### Phase 3: 实现安全屋整备系统（核心策略）
- [ ] 拖拽系统（拖拽组件到网格）
- [ ] 商店系统（刷新、购买）
- [ ] 修复系统（消耗BlueRes修复组件）
- [ ] 安全屋UI界面

### Phase 4: 实现安全屋↔旅途循环
- [ ] 旅途完成后进入安全屋
- [ ] 安全屋点击"出发"进入下一段旅途
- [ ] 移除波次系统，改为距离/时间目标

## 用户反馈的精准性

> "最核心流程根本都不完整"

完全正确！核心流程是：
**安全屋拼装 ↔ 旅途战斗**

但实际只有：
**波次战斗（且玩家无交互）**

缺少：
1. 安全屋阶段
2. 玩家交互（光标攻击）
3. 策略决策（拼装、升级）
