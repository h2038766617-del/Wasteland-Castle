# 🚨 核心流程致命问题

## 问题：波次可能永远无法完成

### 症状
游戏的核心流程（完成波次→下一波→胜利）可能完全卡死

### 根本原因分析

#### 1. 弹药经济崩溃 🔴 致命
**位置**：游戏平衡设计

**弹药消耗计算**：
- 初始弹药：200
- weapon_basic_1: ammoCost=1, cooldown=0.5s → 每秒消耗2弹药（如果有目标）
- weapon_heavy_1: ammoCost=5, cooldown=2.0s → 每秒消耗2.5弹药（如果有目标）
- **两个武器同时射击：每秒消耗约4.5弹药**

**波次需求**：
- 第1波：10个敌人 × 50HP = 500HP总量
- 假设命中率100%，需要发射：500/10(weapon1) = 50发（ammoCost=50）
- **实际：考虑miss、多武器射击、过度射击，可能消耗100+弹药**

**敌人掉落**：
- 每个敌人掉落：red +5
- 第1波总掉落：10 × 5 = 50红色资源

**结果**：
- 消耗 > 掉落
- 玩家需要采集资源补充
- **但如果资源节点不够，或玩家不知道要采集，弹药耗尽**
- **弹药耗尽 → 无法射击 → 敌人无法消灭 → 波次永远无法完成 → 游戏卡死**

#### 2. 资源生成可能不足 🔴 严重
**位置**：`src/systems/ResourceSystem.js`

**生成配置**：
```javascript
this.spawnInterval = 10.0; // 每10秒生成一个
this.maxActiveNodes = 5;   // 最多同时5个
```

**问题**：
- 10秒才生成1个资源节点
- 采集需要3秒（harvestTime）
- 如果玩家在战斗中无暇采集，资源节点会被卷轴带走（超出屏幕）
- **资源生成速度 < 弹药消耗速度**

#### 3. 玩家可能不知道要采集 ⚠️ 设计问题
**问题**：
- 游戏没有新手引导
- UI没有明确提示"悬停光标到资源上采集"
- 玩家可能以为资源会自动采集
- **结果：弹药耗尽，游戏无法进行**

---

## 🔍 验证方法

### 测试场景：第1波结束时弹药是否充足

**预期**：
- 初始：200红色资源
- 第1波消耗：约100（估算）
- 第1波掉落：50
- 采集资源：需要采集50+才能持平

**如果玩家没采集资源**：
- 第1波后剩余：150
- 第2波消耗：约120（12个敌人）
- 第2波后剩余：30+60(掉落)=90
- 第3波需要：约140（14个敌人）
- **弹药不足，无法完成第3波**

---

## 🛠️ 可能的修复方案

###方案1：增加敌人掉落
```javascript
this.rewardRed = 10; // 从5改为10
```

### 方案2：减少武器弹药消耗
```javascript
ammoCost: 0.5,  // weapon1从1改为0.5ammoCost: 3,   // weapon2从5改为3
```

### 方案3：增加资源节点生成
```javascript
this.spawnInterval = 5.0; // 从10秒改为5秒
this.maxActiveNodes = 10; // 从5改为10
```

### 方案4：增加初始资源
```javascript
red: 500,  // 从200改为500
```

### 方案5：自动采集附近资源
添加自动采集机制，玩家无需手动悬停

---

## 🎯 建议

**立即修复**：
1. 检查实际游戏中弹药消耗速度
2. 调整弹药经济平衡（方案1+方案2）
3. 增加新手提示："悬停光标到资源上采集补充弹药"

**长期改进**：
- 添加弹药不足警告UI
- 添加资源采集提示
- 优化资源生成频率
